<article><div class="l"><div class="gg gh gi gj gk gl gm ce gn ch l"></div><div class="l"><header class="pw-post-byline-header go gp gq gr gs gt gu gv gw gx l"><div class="o gy u"><div class="o"><div class="fj l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@kennychen12?source=post_page-----524e6259f59f--------------------------------" rel="noopener follow"><div class="l do"><img alt="Kenneth Chen" class="l ch fl gz ha fp" height="48" loading="lazy" src="https://miro.medium.com/fit/c/96/96/1*i0r6c9DT9IwH9-3tBPrnBQ.jpeg" width="48"/><div class="fk fl l gz ha fo aq"></div></div></a></div><div class="l"><div class="pw-author bm b dm dn ga"><div class="hb o hc"><div><div aria-hidden="false" class="ci"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@kennychen12?source=post_page-----524e6259f59f--------------------------------" rel="noopener follow">Kenneth Chen</a></div></div><div class="hd he hf hg hh d"><span><a class="bm b hi bo hj hk hl hm hn ho hp bd bz hq hr hs cd cf cg ch ci cj" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Faea2a5778a47&amp;operation=register&amp;redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomating-data-drift-thresholding-in-machine-learning-systems-524e6259f59f&amp;user=Kenneth+Chen&amp;userId=aea2a5778a47&amp;source=post_page-aea2a5778a47----524e6259f59f---------------------follow_byline-----------" rel="noopener follow">Follow</a></span></div></div></div><div class="o ao ht"><p class="pw-published-date bm b bn bo cn"><span>Nov 1, 2021</span></p><div aria-hidden="true" class="hu ci"><span aria-hidden="true" class="l"><span class="bm b bn bo cn">·</span></span></div><div class="pw-reading-time bm b bn bo cn">12 min read</div></div></div></div><div class="o ao"><div class="h k hv hw hx"><div class="hy l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on twitter" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M20 5.34c-.67.41-1.4.7-2.18.87a3.45 3.45 0 0 0-5.02-.1 3.49 3.49 0 0 0-1.02 2.47c0 .28.03.54.07.8a9.91 9.91 0 0 1-7.17-3.66 3.9 3.9 0 0 0-.5 1.74 3.6 3.6 0 0 0 1.56 2.92 3.36 3.36 0 0 1-1.55-.44V10c0 1.67 1.2 3.08 2.8 3.42-.3.06-.6.1-.94.12l-.62-.06a3.5 3.5 0 0 0 3.24 2.43 7.34 7.34 0 0 1-4.36 1.49l-.81-.05a9.96 9.96 0 0 0 5.36 1.56c6.4 0 9.91-5.32 9.9-9.9v-.5c.69-.49 1.28-1.1 1.74-1.81-.63.3-1.3.48-2 .56A3.33 3.33 0 0 0 20 5.33" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="hy l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on facebook" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M19.75 12.04c0-4.3-3.47-7.79-7.75-7.79a7.77 7.77 0 0 0-5.9 12.84 7.77 7.77 0 0 0 4.69 2.63v-5.49h-1.9v-2.2h1.9v-1.62c0-1.88 1.14-2.9 2.8-2.9.8 0 1.49.06 1.69.08v1.97h-1.15c-.91 0-1.1.43-1.1 1.07v1.4h2.17l-.28 2.2h-1.88v5.52a7.77 7.77 0 0 0 6.7-7.71" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="hy l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on linkedin" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M19.75 5.39v13.22a1.14 1.14 0 0 1-1.14 1.14H5.39a1.14 1.14 0 0 1-1.14-1.14V5.39a1.14 1.14 0 0 1 1.14-1.14h13.22a1.14 1.14 0 0 1 1.14 1.14zM8.81 10.18H6.53v7.3H8.8v-7.3zM9 7.67a1.31 1.31 0 0 0-1.3-1.32h-.04a1.32 1.32 0 0 0 0 2.64A1.31 1.31 0 0 0 9 7.71v-.04zm8.46 5.37c0-2.2-1.4-3.05-2.78-3.05a2.6 2.6 0 0 0-2.3 1.18h-.07v-1h-2.14v7.3h2.28V13.6a1.51 1.51 0 0 1 1.36-1.63h.09c.72 0 1.26.45 1.26 1.6v3.91h2.28l.02-4.43z" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="l fr"><div><div aria-hidden="false" class="ci"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path clip-rule="evenodd" d="M3.57 14.67c0-.57.13-1.11.38-1.6l.02-.02v-.02l.02-.02c0-.02 0-.02.02-.02.12-.26.3-.52.57-.8L7.78 9v-.02l.01-.02c.44-.41.91-.7 1.44-.85a4.87 4.87 0 0 0-1.19 2.36A5.04 5.04 0 0 0 8 11.6L6.04 13.6c-.19.19-.32.4-.38.65a2 2 0 0 0 0 .9c.08.2.2.4.38.57l1.29 1.31c.27.28.62.42 1.03.42.42 0 .78-.14 1.06-.42l1.23-1.25.79-.78 1.15-1.16c.08-.09.19-.22.28-.4.1-.2.15-.42.15-.67 0-.16-.02-.3-.06-.45l-.02-.02v-.02l-.07-.14s0-.03-.04-.06l-.06-.13-.02-.02c0-.02 0-.03-.02-.05a.6.6 0 0 0-.14-.16l-.48-.5c0-.04.02-.1.04-.15l.06-.12 1.17-1.14.09-.09.56.57c.02.04.08.1.16.18l.05.04.03.06.04.05.03.04.04.06.1.14.02.02c0 .02.01.03.03.04l.1.2v.02c.1.16.2.38.3.68a1 1 0 0 1 .04.25 3.2 3.2 0 0 1 .02 1.33 3.49 3.49 0 0 1-.95 1.87l-.66.67-.97.97-1.56 1.57a3.4 3.4 0 0 1-2.47 1.02c-.97 0-1.8-.34-2.49-1.03l-1.3-1.3a3.55 3.55 0 0 1-1-2.51v-.01h-.02v.02zm5.39-3.43c0-.19.02-.4.07-.63.13-.74.44-1.37.95-1.87l.66-.67.97-.98 1.56-1.56c.68-.69 1.5-1.03 2.47-1.03.97 0 1.8.34 2.48 1.02l1.3 1.32a3.48 3.48 0 0 1 1 2.48c0 .58-.11 1.11-.37 1.6l-.02.02v.02l-.02.04c-.14.27-.35.54-.6.8L16.23 15l-.01.02-.01.02c-.44.42-.92.7-1.43.83a4.55 4.55 0 0 0 1.23-3.52L18 10.38c.18-.21.3-.42.35-.65a2.03 2.03 0 0 0-.01-.9 1.96 1.96 0 0 0-.36-.58l-1.3-1.3a1.49 1.49 0 0 0-1.06-.42c-.42 0-.77.14-1.06.4l-1.2 1.27-.8.8-1.16 1.15c-.08.08-.18.21-.29.4a1.66 1.66 0 0 0-.08 1.12l.02.03v.02l.06.14s.01.03.05.06l.06.13.02.02.01.02.01.02c.05.08.1.13.14.16l.47.5c0 .04-.02.09-.04.15l-.06.12-1.15 1.15-.1.08-.56-.56a2.3 2.3 0 0 0-.18-.19c-.02-.01-.02-.03-.02-.04l-.02-.02a.37.37 0 0 1-.1-.12c-.03-.03-.05-.04-.05-.06l-.1-.15-.02-.02-.02-.04-.08-.17v-.02a5.1 5.1 0 0 1-.28-.69 1.03 1.03 0 0 1-.04-.26c-.06-.23-.1-.46-.1-.7v.01z" fill="#A8A8A8" fill-rule="evenodd"></path></svg></span></button></div></div></div><div class="ib o ao"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F524e6259f59f&amp;operation=register&amp;redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomating-data-drift-thresholding-in-machine-learning-systems-524e6259f59f&amp;source=--------------------------bookmark_header-----------" rel="noopener follow"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" class="au de aw ax ay az ba hz bc id ie if ig"><svg aria-label="Add to list bookmark button" class="ic" fill="none" height="25" viewbox="0 0 25 25" width="25"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></button></a></span></div></div><div class="ck ih"><div><div aria-hidden="false" class="ci"></div></div></div></div></div><div class="ii ij ik j i d"><div class="fj l"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F524e6259f59f&amp;operation=register&amp;redirect=https%3A%2F%2Ftowardsdatascience.com%2Fautomating-data-drift-thresholding-in-machine-learning-systems-524e6259f59f&amp;source=--------------------------bookmark_header-----------" rel="noopener follow"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" class="au de aw il ay az ba im bc id cd o ao in io ig"><svg aria-label="Add to list bookmark button" class="ic" fill="none" height="25" viewbox="0 0 25 25" width="25"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg><p class="bm b bn bo cn">Save</p></button></a></span></div><div class="ip l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on twitter" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M20 5.34c-.67.41-1.4.7-2.18.87a3.45 3.45 0 0 0-5.02-.1 3.49 3.49 0 0 0-1.02 2.47c0 .28.03.54.07.8a9.91 9.91 0 0 1-7.17-3.66 3.9 3.9 0 0 0-.5 1.74 3.6 3.6 0 0 0 1.56 2.92 3.36 3.36 0 0 1-1.55-.44V10c0 1.67 1.2 3.08 2.8 3.42-.3.06-.6.1-.94.12l-.62-.06a3.5 3.5 0 0 0 3.24 2.43 7.34 7.34 0 0 1-4.36 1.49l-.81-.05a9.96 9.96 0 0 0 5.36 1.56c6.4 0 9.91-5.32 9.9-9.9v-.5c.69-.49 1.28-1.1 1.74-1.81-.63.3-1.3.48-2 .56A3.33 3.33 0 0 0 20 5.33" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="ip l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on facebook" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M19.75 12.04c0-4.3-3.47-7.79-7.75-7.79a7.77 7.77 0 0 0-5.9 12.84 7.77 7.77 0 0 0 4.69 2.63v-5.49h-1.9v-2.2h1.9v-1.62c0-1.88 1.14-2.9 2.8-2.9.8 0 1.49.06 1.69.08v1.97h-1.15c-.91 0-1.1.43-1.1 1.07v1.4h2.17l-.28 2.2h-1.88v5.52a7.77 7.77 0 0 0 6.7-7.71" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="ip l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on linkedin" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M19.75 5.39v13.22a1.14 1.14 0 0 1-1.14 1.14H5.39a1.14 1.14 0 0 1-1.14-1.14V5.39a1.14 1.14 0 0 1 1.14-1.14h13.22a1.14 1.14 0 0 1 1.14 1.14zM8.81 10.18H6.53v7.3H8.8v-7.3zM9 7.67a1.31 1.31 0 0 0-1.3-1.32h-.04a1.32 1.32 0 0 0 0 2.64A1.31 1.31 0 0 0 9 7.71v-.04zm8.46 5.37c0-2.2-1.4-3.05-2.78-3.05a2.6 2.6 0 0 0-2.3 1.18h-.07v-1h-2.14v7.3h2.28V13.6a1.51 1.51 0 0 1 1.36-1.63h.09c.72 0 1.26.45 1.26 1.6v3.91h2.28l.02-4.43z" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="l fr"><div><div aria-hidden="false" class="ci"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path clip-rule="evenodd" d="M3.57 14.67c0-.57.13-1.11.38-1.6l.02-.02v-.02l.02-.02c0-.02 0-.02.02-.02.12-.26.3-.52.57-.8L7.78 9v-.02l.01-.02c.44-.41.91-.7 1.44-.85a4.87 4.87 0 0 0-1.19 2.36A5.04 5.04 0 0 0 8 11.6L6.04 13.6c-.19.19-.32.4-.38.65a2 2 0 0 0 0 .9c.08.2.2.4.38.57l1.29 1.31c.27.28.62.42 1.03.42.42 0 .78-.14 1.06-.42l1.23-1.25.79-.78 1.15-1.16c.08-.09.19-.22.28-.4.1-.2.15-.42.15-.67 0-.16-.02-.3-.06-.45l-.02-.02v-.02l-.07-.14s0-.03-.04-.06l-.06-.13-.02-.02c0-.02 0-.03-.02-.05a.6.6 0 0 0-.14-.16l-.48-.5c0-.04.02-.1.04-.15l.06-.12 1.17-1.14.09-.09.56.57c.02.04.08.1.16.18l.05.04.03.06.04.05.03.04.04.06.1.14.02.02c0 .02.01.03.03.04l.1.2v.02c.1.16.2.38.3.68a1 1 0 0 1 .04.25 3.2 3.2 0 0 1 .02 1.33 3.49 3.49 0 0 1-.95 1.87l-.66.67-.97.97-1.56 1.57a3.4 3.4 0 0 1-2.47 1.02c-.97 0-1.8-.34-2.49-1.03l-1.3-1.3a3.55 3.55 0 0 1-1-2.51v-.01h-.02v.02zm5.39-3.43c0-.19.02-.4.07-.63.13-.74.44-1.37.95-1.87l.66-.67.97-.98 1.56-1.56c.68-.69 1.5-1.03 2.47-1.03.97 0 1.8.34 2.48 1.02l1.3 1.32a3.48 3.48 0 0 1 1 2.48c0 .58-.11 1.11-.37 1.6l-.02.02v.02l-.02.04c-.14.27-.35.54-.6.8L16.23 15l-.01.02-.01.02c-.44.42-.92.7-1.43.83a4.55 4.55 0 0 0 1.23-3.52L18 10.38c.18-.21.3-.42.35-.65a2.03 2.03 0 0 0-.01-.9 1.96 1.96 0 0 0-.36-.58l-1.3-1.3a1.49 1.49 0 0 0-1.06-.42c-.42 0-.77.14-1.06.4l-1.2 1.27-.8.8-1.16 1.15c-.08.08-.18.21-.29.4a1.66 1.66 0 0 0-.08 1.12l.02.03v.02l.06.14s.01.03.05.06l.06.13.02.02.01.02.01.02c.05.08.1.13.14.16l.47.5c0 .04-.02.09-.04.15l-.06.12-1.15 1.15-.1.08-.56-.56a2.3 2.3 0 0 0-.18-.19c-.02-.01-.02-.03-.02-.04l-.02-.02a.37.37 0 0 1-.1-.12c-.03-.03-.05-.04-.05-.06l-.1-.15-.02-.02-.02-.04-.08-.17v-.02a5.1 5.1 0 0 1-.28-.69 1.03 1.03 0 0 1-.04-.26c-.06-.23-.1-.46-.1-.7v.01z" fill="#A8A8A8" fill-rule="evenodd"></path></svg></span></button></div></div></div></div></header><span class="l"></span><section><div><div class="fo as iv iw ix iy"></div><div class="iz ja jb jc jd"><div class=""><h1 class="pw-post-title je jf jg bm jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc ga" id="4735">Automating Data Drift Thresholding in Machine Learning Systems</h1></div><div class=""><h2 class="pw-subtitle-paragraph kd jf jg bm b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku cn" id="d242">Monitoring Production ML Model Inputs Practically and Efficiently in the Absence of Ground Truth Data</h2></div><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm kv"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*u9ScE3mV4BSUfPdU 640w, https://miro.medium.com/max/720/0*u9ScE3mV4BSUfPdU 720w, https://miro.medium.com/max/750/0*u9ScE3mV4BSUfPdU 750w, https://miro.medium.com/max/786/0*u9ScE3mV4BSUfPdU 786w, https://miro.medium.com/max/828/0*u9ScE3mV4BSUfPdU 828w, https://miro.medium.com/max/1100/0*u9ScE3mV4BSUfPdU 1100w, https://miro.medium.com/max/1400/0*u9ScE3mV4BSUfPdU 1400w"/><img alt="" class="ce lf lg c" height="499" loading="eager" role="presentation" width="700"/></picture></div></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">Photo by <a class="au lk" href="https://unsplash.com/@kmuza?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Carlos Muza</a> on <a class="au lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="fb19"><strong class="ln jh">UPDATE</strong>: I had the opportunity to present and record the principles here at the MLOps World NYC Conference on 3/30/22. If you prefer a verbal treatment of the material below, <a class="au lk" href="https://drive.google.com/file/d/1j685xSzMnSYL5NqcAexmvpYi-xnjJSkC/view?usp=share_link" rel="noopener ugc nofollow" target="_blank">here is the recording</a>.</p></div><div class="o dx mh mi ii mj" role="separator"><span class="mk fl ci ml mm mn"></span><span class="mk fl ci ml mm mn"></span><span class="mk fl ci ml mm"></span></div><div class="iz ja jb jc jd"><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="4a10">In real life ML monitoring applications, we want to detect whether or not a ML model is performing well or is breaking. Not picking up on poor model performance can translate into poor or even biased predictions that can lead to lost revenue and even PR fires that we see year over year from even the large tech companies, from facial recognition systems that fail to pick up on certain minorities to hate speech in autocomplete for search engines.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="08bd">In this article, we’ll go over a brief overview of how data drift thresholding helps capture poor model performance, and the majority of the post will focus on two versions of implementing automated data drift detection in production level ML monitoring systems.</p><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="70e7">Overview</h1><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="3cbc">Why do we need data drift?</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="bdad">The standard approach to monitoring models is based on performance metrics, i.e. accuracy/precision/recall/f-score, over some time period or from batch to batch. In order to produce these metrics, we need both predictions and ground truth labels for the datapoints, e.g. a credit risk model predicts that a person will pay their loan on time in 1 year and thus should be approved for a credit card, and we know whether or not that person paid their loan on time in 1 year. Already, we have an issue because we do not know ground truth until 1 year later.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="85d2">In most production applications, there is a lag between prediction time and ground truth collection time, which significantly handicaps the ability to remediate model issues quickly. Leveraging labeling teams or services can help close this lag, but it will not completely remove it. As such, instead of monitoring metrics based on outputs, we can instead monitor inputs based on data drift metrics.</p><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="8929">What is data drift?</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="8c1a">Data drift fundamentally measures the change in statistical distribution between two distributions, usually the same feature but at different points in time. As an example, in the univariate case where we’re looking at one input feature, we should reasonably expect that, if the shape of the feature shifts significantly between training time and prediction time, the model outputs will degrade in quality.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="a0e2">As a toy example, if we train a ML model to solve math problems only on algebra questions, and all of a sudden geometry questions are fed into the model at prediction time, we’d expect the predictions to be pretty bad since the model hasn’t been trained on geometry questions.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="f813">In essence, data drift is a proxy for our classical performance metrics in the absence of ground truth labels. The next natural question is how to formally quantify data drift.</p><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="f9b2">Overview of data drift metrics</h1><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="57c2">There are many different kinds of metrics we could use for quantifying data drift. Here, we’ll focus on two popular families of metrics: f-divergence and hypothesis test metrics. For the former, we’ll look at KL Divergence and PSI. For the latter, we’ll look at Chi-Squared and KS test statistics.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="d5af">For any drift metrics, <em class="nz">P</em> is the training data (reference set) on which the ML model was trained and <em class="nz">Q</em><strong class="ln jh"><em class="nz"> </em></strong>is the data on which the model is performing predictions (inference set), which can be defined on a rolling time window for streaming models or a batch basis for batch models.</p><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="65a9">KL Divergence</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="10ec">If you need a quick overview, I’ve found this introductory <a class="au lk" href="https://www.countbayesie.com/blog/2017/5/9/kullback-leibler-divergence-explained" rel="noopener ugc nofollow" target="_blank">post</a> very helpful.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="4cd1">KL Divergence from <em class="nz">P</em> to <em class="nz">Q </em>is interpreted as the nats of information we expect to lose in using <em class="nz">Q</em> instead of <em class="nz">P</em> for modeling data <em class="nz">X</em>, discretized over probability space <em class="nz">K</em>. KL Divergence is not symmetrical, i.e. the value is different if <em class="nz">P</em> and <em class="nz">Q</em> are swapped, and should not be used as a distance metric.</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm oa"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 618px" srcset="https://miro.medium.com/max/640/1*ApXRTQw85xiqutHXGAArwg.png 640w, https://miro.medium.com/max/720/1*ApXRTQw85xiqutHXGAArwg.png 720w, https://miro.medium.com/max/750/1*ApXRTQw85xiqutHXGAArwg.png 750w, https://miro.medium.com/max/786/1*ApXRTQw85xiqutHXGAArwg.png 786w, https://miro.medium.com/max/828/1*ApXRTQw85xiqutHXGAArwg.png 828w, https://miro.medium.com/max/1100/1*ApXRTQw85xiqutHXGAArwg.png 1100w, https://miro.medium.com/max/1236/1*ApXRTQw85xiqutHXGAArwg.png 1236w"/><img alt="" class="ce lf lg c" height="141" loading="lazy" role="presentation" width="618"/></picture></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">Discretized KL Divergence</figcaption></figure><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="a7a3">Population Stability Index (PSI)</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="2c34">While KL Divergence is well-known, it’s usually used as a regularizing penalty term in generative models like VAEs. A more appropriate metric that can be used as a distance metric is Population Stability Index (PSI), which measures the roundtrip loss of nats of information we expect to lose from <em class="nz">P</em> to <em class="nz">Q</em> and then from <em class="nz">Q</em> returning back to <em class="nz">P.</em></p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm ob"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/1*-_2MGjtHHB1S8RscYf9RJg.png 640w, https://miro.medium.com/max/720/1*-_2MGjtHHB1S8RscYf9RJg.png 720w, https://miro.medium.com/max/750/1*-_2MGjtHHB1S8RscYf9RJg.png 750w, https://miro.medium.com/max/786/1*-_2MGjtHHB1S8RscYf9RJg.png 786w, https://miro.medium.com/max/828/1*-_2MGjtHHB1S8RscYf9RJg.png 828w, https://miro.medium.com/max/1100/1*-_2MGjtHHB1S8RscYf9RJg.png 1100w, https://miro.medium.com/max/1400/1*-_2MGjtHHB1S8RscYf9RJg.png 1400w"/><img alt="" class="ce lf lg c" height="162" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">Discretized PSI</figcaption></figure><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="2e5d">Hypothesis Tests</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="326b">Hypothesis testing uses different tests depending on whether a feature is categorical or continuous.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="cea6">For a categorical feature with <em class="nz">K</em> categories, i.e. <em class="nz">K</em>−1 are the degrees of freedom, where N_Pk and N_Qk are the count of occurrences of the feature being <em class="nz">k</em>, with 1≤<em class="nz">k</em>≤<em class="nz">K</em>, for <em class="nz">P</em> and <em class="nz">Q</em> respectively, then the Chi-Squared test statistic is the summation of the standardized squared differences of expected counts between <em class="nz">P</em> and <em class="nz">Q</em>.</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm oc"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 436px" srcset="https://miro.medium.com/max/640/1*p8I9UrEwMjZEFd56zMQc5A.png 640w, https://miro.medium.com/max/720/1*p8I9UrEwMjZEFd56zMQc5A.png 720w, https://miro.medium.com/max/750/1*p8I9UrEwMjZEFd56zMQc5A.png 750w, https://miro.medium.com/max/786/1*p8I9UrEwMjZEFd56zMQc5A.png 786w, https://miro.medium.com/max/828/1*p8I9UrEwMjZEFd56zMQc5A.png 828w, https://miro.medium.com/max/1100/1*p8I9UrEwMjZEFd56zMQc5A.png 1100w, https://miro.medium.com/max/872/1*p8I9UrEwMjZEFd56zMQc5A.png 872w"/><img alt="" class="ce lf lg c" height="92" loading="lazy" role="presentation" width="436"/></picture></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">Chi-Squared Statistic with <em class="od">K-1 degrees of freedom</em></figcaption></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="cd45">For a continuous features with F_P and F_Q being the empirical cumulative densities, for <em class="nz">P</em> and <em class="nz">Q</em> respectively, the Kolmogorov-Smirnov (KS) test is a nonparametric, i.e. distribution-free, test that compares the empirical cumulative density functions F_P and F_Q.</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm oc"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 436px" srcset="https://miro.medium.com/max/640/1*P994i1Wv3Gi23LVrLuxBRw.png 640w, https://miro.medium.com/max/720/1*P994i1Wv3Gi23LVrLuxBRw.png 720w, https://miro.medium.com/max/750/1*P994i1Wv3Gi23LVrLuxBRw.png 750w, https://miro.medium.com/max/786/1*P994i1Wv3Gi23LVrLuxBRw.png 786w, https://miro.medium.com/max/828/1*P994i1Wv3Gi23LVrLuxBRw.png 828w, https://miro.medium.com/max/1100/1*P994i1Wv3Gi23LVrLuxBRw.png 1100w, https://miro.medium.com/max/872/1*P994i1Wv3Gi23LVrLuxBRw.png 872w"/><img alt="" class="ce lf lg c" height="49" loading="lazy" role="presentation" width="436"/></picture></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">Kolmogorov-Smirnov Test Statistic</figcaption></figure><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="98df">Why Automated Drift Thresholds?</h1><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm oe"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*pmT3irN-2gCZwqu- 640w, https://miro.medium.com/max/720/0*pmT3irN-2gCZwqu- 720w, https://miro.medium.com/max/750/0*pmT3irN-2gCZwqu- 750w, https://miro.medium.com/max/786/0*pmT3irN-2gCZwqu- 786w, https://miro.medium.com/max/828/0*pmT3irN-2gCZwqu- 828w, https://miro.medium.com/max/1100/0*pmT3irN-2gCZwqu- 1100w, https://miro.medium.com/max/1400/0*pmT3irN-2gCZwqu- 1400w"/><img alt="" class="ce lf lg c" height="467" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">Photo by <a class="au lk" href="https://unsplash.com/@scottrodgerson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Scott Rodgerson</a> on <a class="au lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="84b6">Having humans manually look at drift metrics produced by a model over time or over batches is obviously tedious and not ideal, and the immediate use case for drift metrics would be to set alerts based on some threshold, e.g. PSI jumps over .3 for this batch and should create an alert for a person to examine. Remediation actions could be checking if a pipeline that’s feeding that feature into the model is broken, if there was a recent buggy code or calculation change, or if the feature really did drift and suggests that the model needs to be retrained.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="c25a">But where did that .3 come from? Setting arbitrary handpicked thresholds is not a good solution. If the threshold is too high, alerts that should be brought up are now ignored (more false negatives). If the threshold is too low, alerts that should not be brought up are now present (more false positives).</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="f765">A universal constant threshold is not robust because that threshold should depend on the shape of the the training data <em class="nz">P</em>. If <em class="nz">P </em>is uniform and we see a unimodal <em class="nz">Q</em>, that drift value is going to be significantly less than if <em class="nz">P</em> was highly unimodal and centered at some mean far away from that same <em class="nz">Q</em>, since the former <em class="nz">P</em> that is uniform is less certain if <em class="nz">Q</em> did not come from <em class="nz">P</em>. An example is shown below.</p><figure class="kw kx ky kz gx la"><div class="m fs l do"><div class="of og l"></div></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="e717">In order to set robust thresholds that make sense for an alerting system, we’ll dive into how to automate calculation of such thresholds. That is, we want to recommend data drift thresholds to create alerts, so users (a) don’t have to manually set alerts and (b) don’t have to determine what a good threshold value is.</p></div><div class="o dx mh mi ii mj" role="separator"><span class="mk fl ci ml mm mn"></span><span class="mk fl ci ml mm mn"></span><span class="mk fl ci ml mm"></span></div><div class="iz ja jb jc jd"><h1 class="mo mp jg bm mq mr oh mt mu mv oi mx my km oj kn na kp ok kq nc ks ol kt ne nf ga" id="1a52">Automated Drift Thresholds for Hypothesis Test Metrics</h1><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="2451">For hypothesis test metrics, the trivial solution would be setting thresholds at the the proper critical values for each test using the traditional α=.05, i.e. 95% confident that any hypothesis metric above the respective critical value suggests significant drift where <em class="nz">Q</em> ∼ <em class="nz">P </em>is likely false.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="61d1">Hypothesis tests, however, come with limitations, from<a class="au lk" href="https://www.mtholyoke.edu/courses/etownsle/qr/Chi%20square%20limitations.htm" rel="noopener ugc nofollow" target="_blank"> sample sizes influencing significance</a> for the Chi-Squared test to<a class="au lk" href="https://www.itl.nist.gov/div898/handbook/eda/section3/eda35g.htm" rel="noopener ugc nofollow" target="_blank"> sensitivity in the center of the distribution rather than the tails</a> for the KS test.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="0aa7">For those reasons, it’s important to explore other classes of drift metrics such as f-divergence metrics, and we’ll now explore ways to automate f-divergence drift thresholds.</p><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="3f55">Automated Drift Thresholds V1: Bootstrapping</h1><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="64de">Overview</h2><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm om"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/1*5yBLAHI1ZK3KvSyWPC11IQ.jpeg 640w, https://miro.medium.com/max/720/1*5yBLAHI1ZK3KvSyWPC11IQ.jpeg 720w, https://miro.medium.com/max/750/1*5yBLAHI1ZK3KvSyWPC11IQ.jpeg 750w, https://miro.medium.com/max/786/1*5yBLAHI1ZK3KvSyWPC11IQ.jpeg 786w, https://miro.medium.com/max/828/1*5yBLAHI1ZK3KvSyWPC11IQ.jpeg 828w, https://miro.medium.com/max/1100/1*5yBLAHI1ZK3KvSyWPC11IQ.jpeg 1100w, https://miro.medium.com/max/1400/1*5yBLAHI1ZK3KvSyWPC11IQ.jpeg 1400w"/><img alt="" class="ce lf lg c" height="732" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">System for Bootstrapped Automated Drift Thresholds (Image by Author)</figcaption></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="6504">(1) For a large number of simulations indexed by <em class="nz">i</em>, for a given input feature, bootstrap sample <em class="nz">m</em> times, where <em class="nz">m</em> is sufficiently large, from the reference set <em class="nz">P</em> and construct an inference distribution <em class="nz">Q</em>ᵢ*, which represents what we’d expect had our data truly come from <em class="nz">P </em>via simulation. Then we calculate and keep track of data drift f(<em class="nz">P, Q</em>ᵢ*) for each simulation.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="bcc6">(2) We set the data drift threshold to the conservative value of max_i(f(<em class="nz">P, Q</em>ᵢ*)), which is essentially a critical value/cutoff where α → 0 in a traditional statistics setting, i.e. we are 99.999% confident that a data drift value from an actual <em class="nz">Q</em>, i.e.<em class="nz"> </em>inference time slice or batch, that is above the threshold signifies that the inference data was not produced from the same underlying distribution as <em class="nz">P</em>. If incurring false positives is not expensive, then we could set the threshold instead to the 95% percentile of f(<em class="nz">P, Q</em>ᵢ*) in the traditional α=.05 one-sided setting.</p><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="5470">Limitations of Bootstrapping</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="cad8">Bootstrapping is attractive because it is simulation-based and distribution-free, but this method is not scalable due to two issues.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="3af4">(1) Running simulations for every feature per model is computationally expensive. Specifically, runtime on a per model basis would be <code class="fp on oo op oq b">O(n_features*n_categories_per_feature*n_metrics*n_simulations)</code>.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="59bb">(2) The assumption of sampling stability is broken with lower sample sizes.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="d4ab">As a toy example, let’s say we have red, white, blue, and orange marbles in <em class="nz">P</em>, distributed uniformly. Let’s now present <em class="nz">Q</em> of size 3; there is no way to tell if the <em class="nz">Q </em>came from <em class="nz">P</em> or not since there is no way for us to represent all four colors. Even if we had sampled 6 marbles, we could not closely approximate 1/4 for each category given those 6 marbles.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="8494">Let <em class="nz">m</em> be the number of simulated datapoints on each simulation to create <em class="nz">Q</em>ᵢ*. In the same toy example of marbles, sampling instability causes artificially high uncertainty(and therefore artificially high data drift thresholds) when <em class="nz">m</em> is low, as <em class="nz">P</em> has not been well sampled and represented in <em class="nz">Q</em>ᵢ*.</p><figure class="kw kx ky kz gx la"><div class="m fs l do"><div class="of og l"></div></div></figure><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm or"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 417px" srcset="https://miro.medium.com/max/640/1*KY4xuYtNQm92CWCvwL5GcA.png 640w, https://miro.medium.com/max/720/1*KY4xuYtNQm92CWCvwL5GcA.png 720w, https://miro.medium.com/max/750/1*KY4xuYtNQm92CWCvwL5GcA.png 750w, https://miro.medium.com/max/786/1*KY4xuYtNQm92CWCvwL5GcA.png 786w, https://miro.medium.com/max/828/1*KY4xuYtNQm92CWCvwL5GcA.png 828w, https://miro.medium.com/max/1100/1*KY4xuYtNQm92CWCvwL5GcA.png 1100w, https://miro.medium.com/max/834/1*KY4xuYtNQm92CWCvwL5GcA.png 834w"/><img alt="" class="ce lf lg c" height="278" loading="lazy" role="presentation" width="417"/></picture></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">KL Divergence Bootstrap Sampling Instability (Image by Author)</figcaption></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="f5d5">The way to fix issue (2) is to create simulated threshold curves for a given feature by varying <em class="nz">m</em>, but now we have exacerbated issue (1) by multiplying runtime by <em class="nz">m</em>. We also now have issues with space complexity, since now we would have to store thresholds in a lookup (database or cache) for use in downstream applications, like an alert service creating alert rules or a query service cache. Forgoing the extra storage and simulating the threshold curve at query time is also not an option since the query would take too long for most user-facing applications.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="e350">In short, the trade-off of using a flexible simulation setup is not worth the computational expenses when taking into account correction curves that would either (a) need to be stored, which would cost a lot in storage fees or blow up a cache, or (b) be simulated at query time, which is too slow for user-facing applications.</p><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="9027">Automated Drift Thresholds V2: Closed-Form Statistics</h1><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm os"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*hMm440wDuKHsRzhw 640w, https://miro.medium.com/max/720/0*hMm440wDuKHsRzhw 720w, https://miro.medium.com/max/750/0*hMm440wDuKHsRzhw 750w, https://miro.medium.com/max/786/0*hMm440wDuKHsRzhw 786w, https://miro.medium.com/max/828/0*hMm440wDuKHsRzhw 828w, https://miro.medium.com/max/1100/0*hMm440wDuKHsRzhw 1100w, https://miro.medium.com/max/1400/0*hMm440wDuKHsRzhw 1400w"/><img alt="" class="ce lf lg c" height="466" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">Photo by <a class="au lk" href="https://unsplash.com/@edge2edgemedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Edge2Edge Media</a> on <a class="au lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="1c66">It turns out that we can upper bound data drift thresholds in one shot using probability theory. We’ll make use of standard probability theory, the <a class="au lk" href="https://en.wikipedia.org/wiki/Dirichlet_distribution" rel="noopener ugc nofollow" target="_blank">Dirichlet distribution</a>, and <a class="au lk" href="https://en.wikipedia.org/wiki/Taylor_series" rel="noopener ugc nofollow" target="_blank">first-order Taylor series expansions</a>. Remember that we are still deriving the thresholds on a per feature basis.</p><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="e065">KL Divergence</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="8eb8">First, let</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm ot"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 531px" srcset="https://miro.medium.com/max/640/1*wzqeyKOVc8LggGcx1Sas5g.png 640w, https://miro.medium.com/max/720/1*wzqeyKOVc8LggGcx1Sas5g.png 720w, https://miro.medium.com/max/750/1*wzqeyKOVc8LggGcx1Sas5g.png 750w, https://miro.medium.com/max/786/1*wzqeyKOVc8LggGcx1Sas5g.png 786w, https://miro.medium.com/max/828/1*wzqeyKOVc8LggGcx1Sas5g.png 828w, https://miro.medium.com/max/1100/1*wzqeyKOVc8LggGcx1Sas5g.png 1100w, https://miro.medium.com/max/1062/1*wzqeyKOVc8LggGcx1Sas5g.png 1062w"/><img alt="" class="ce lf lg c" height="250" loading="lazy" role="presentation" width="531"/></picture></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="816f">Reference set <em class="nz">P</em> is known and inference set <em class="nz">Q</em> is unknown. Intuitively, this simply means that we have observed the training data used in creating our ML model and that we’re asking a hypothetical question of what we could expect data drift to be for some hypothetical inference set <em class="nz">Q</em> in the future. Formally,</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm ou"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 678px" srcset="https://miro.medium.com/max/640/1*SmT0Rx0ZX8W8i3HLiQhqyQ.png 640w, https://miro.medium.com/max/720/1*SmT0Rx0ZX8W8i3HLiQhqyQ.png 720w, https://miro.medium.com/max/750/1*SmT0Rx0ZX8W8i3HLiQhqyQ.png 750w, https://miro.medium.com/max/786/1*SmT0Rx0ZX8W8i3HLiQhqyQ.png 786w, https://miro.medium.com/max/828/1*SmT0Rx0ZX8W8i3HLiQhqyQ.png 828w, https://miro.medium.com/max/1100/1*SmT0Rx0ZX8W8i3HLiQhqyQ.png 1100w, https://miro.medium.com/max/1356/1*SmT0Rx0ZX8W8i3HLiQhqyQ.png 1356w"/><img alt="" class="ce lf lg c" height="315" loading="lazy" role="presentation" width="678"/></picture></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="8955">2nd line: Linearity of expectation and conditional probability.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="d860">3rd line: <em class="nz">Q </em>∼ Dirchlet(<strong class="ln jh">α</strong>), i.e. <em class="nz">Q </em>models a probability distribution and is a multivariate generalization of the beta distribution. As such, we can use the digamma ψ function in this case.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="b479"><strong class="ln jh">α</strong> = (α_1, …, α_K) traditionally corresponds to the observed probabilities in the <em class="nz">K</em> categories for the feature from <em class="nz">Q, </em>offset by a small constant, i.e. prior counts. However, <em class="nz">Q</em> is unknown, so how do we derive the correct counts? We do so from <em class="nz">P</em>. After all, the entire point of this expectation statement is to quantify on average the drift we’d expect to see if <em class="nz">Q</em> ∼ <em class="nz">P</em>, and an amount above that value in an actual inference set signifies that we likely have significant drift, i.e. <em class="nz">Q</em> ∼<em class="nz"> P</em> is false.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="0ffa">Back to <strong class="ln jh">α</strong>, we can use a Bayesian uniform prior <em class="nz">Q</em> ∼ Dirichlet(<strong class="ln jh">1</strong>_K) and update such that <em class="nz">Q</em>|<em class="nz">P</em> ∼ Dirichlet(<strong class="ln jh">1</strong>_K + N_q * <strong class="ln jh">p</strong>_K), where N_q is the number of datapoints in the inference set <em class="nz">Q </em>and <strong class="ln jh">p</strong>_K corresponds to the known K-dimensional probability vector for the feature from <em class="nz">P</em>. This is the multivariate generalization of the the beta-binomial conjugacy.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="819d">So we thus have,</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm ov"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 449px" srcset="https://miro.medium.com/max/640/1*oCsitfNQyHSf4IcFI7O5Zg.png 640w, https://miro.medium.com/max/720/1*oCsitfNQyHSf4IcFI7O5Zg.png 720w, https://miro.medium.com/max/750/1*oCsitfNQyHSf4IcFI7O5Zg.png 750w, https://miro.medium.com/max/786/1*oCsitfNQyHSf4IcFI7O5Zg.png 786w, https://miro.medium.com/max/828/1*oCsitfNQyHSf4IcFI7O5Zg.png 828w, https://miro.medium.com/max/1100/1*oCsitfNQyHSf4IcFI7O5Zg.png 1100w, https://miro.medium.com/max/898/1*oCsitfNQyHSf4IcFI7O5Zg.png 898w"/><img alt="" class="ce lf lg c" height="33" loading="lazy" role="presentation" width="449"/></picture></div></figure><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="d1a1">Population Stability Index</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="d7cd">PSI gets a bit more tricky and we need to upper-bound the expectation. Let</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm ow"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 681px" srcset="https://miro.medium.com/max/640/1*9EYOhEM2MbfJ4xKsdVRMbQ.png 640w, https://miro.medium.com/max/720/1*9EYOhEM2MbfJ4xKsdVRMbQ.png 720w, https://miro.medium.com/max/750/1*9EYOhEM2MbfJ4xKsdVRMbQ.png 750w, https://miro.medium.com/max/786/1*9EYOhEM2MbfJ4xKsdVRMbQ.png 786w, https://miro.medium.com/max/828/1*9EYOhEM2MbfJ4xKsdVRMbQ.png 828w, https://miro.medium.com/max/1100/1*9EYOhEM2MbfJ4xKsdVRMbQ.png 1100w, https://miro.medium.com/max/1362/1*9EYOhEM2MbfJ4xKsdVRMbQ.png 1362w"/><img alt="" class="ce lf lg c" height="251" loading="lazy" role="presentation" width="681"/></picture></div></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="4eec">Then</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm ox"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/1*tRyybHfbwSq_8FZQUbOyfQ.png 640w, https://miro.medium.com/max/720/1*tRyybHfbwSq_8FZQUbOyfQ.png 720w, https://miro.medium.com/max/750/1*tRyybHfbwSq_8FZQUbOyfQ.png 750w, https://miro.medium.com/max/786/1*tRyybHfbwSq_8FZQUbOyfQ.png 786w, https://miro.medium.com/max/828/1*tRyybHfbwSq_8FZQUbOyfQ.png 828w, https://miro.medium.com/max/1100/1*tRyybHfbwSq_8FZQUbOyfQ.png 1100w, https://miro.medium.com/max/1400/1*tRyybHfbwSq_8FZQUbOyfQ.png 1400w"/><img alt="" class="ce lf lg c" height="457" loading="lazy" role="presentation" width="700"/></picture></div></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="44db">Here are the steps:</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="4c15">2nd line: Linearity of expectation and substituting the result for KL Divergence above.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="64b3">3rd line: Linearity of expectation and conditional probability.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="e0d7">4th line: Expectation of a Dirichlet distribution.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="d6ec">5th line: Delta method approximation (see appendix).</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="9357">6th line: Expectation of a Dirichlet distribution.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="aca5">7th line: Simplifying.</p><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="686d">V1 Issues Solved!</h1><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="1112">Notice how we now have solved for the two issues from bootstrapping.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="0647">(1) We do not have to worry about runtime, as this form is a one shot solution that only involves counts and we can use an approximation to the digamma function.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="8b1c">(2) We handle varying sample sizes by using a Bayesian plus pseudocount setup on the parameters of <em class="nz">Q</em>.</p></div><div class="o dx mh mi ii mj" role="separator"><span class="mk fl ci ml mm mn"></span><span class="mk fl ci ml mm mn"></span><span class="mk fl ci ml mm"></span></div><div class="iz ja jb jc jd"><h1 class="mo mp jg bm mq mr oh mt mu mv oi mx my km oj kn na kp ok kq nc ks ol kt ne nf ga" id="fbbd">Implementation</h1><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="a6f7">In production, how do we implement this dynamic thresholding? Although the thresholds are dynamic depending on the metric and the incoming inference set, all of the expectations above, conditioned on <em class="nz">P</em>, can be expressed as SQL queries or custom but simple functions.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="45e8">Discretizing all continuous features, instead of smoothing discrete features, would be a reasonable trade-off: although we may not capture the full continuous nature of <em class="nz">P </em>and<em class="nz"> Q</em>, we’ll avoid computationally expensive kernel density estimation in representing <em class="nz">P </em>and<em class="nz"> Q</em> as continuous distributions.</p><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="7da9">Wait, what about variance?</h1><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="7c01">We can calculate variances too and apply Delta method approximations, as we would run into variances and covariances on logarithmic terms that cannot be solved using standard probability theory. Those tools are below in the appendix. However, as it turns out, most metrics will not come out as cleanly as KL Divergence, so most of the conditional expectations and variances are upper-bounded via Cauchy-Schwarz. It’s certainly doable to include an additive upper-bounded variance term, or to even use second-order approximations, but the extra computation might not be worth the time gained in exchange for a stricter bound.</p><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="ee82">For another time…</h1><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="9b2b">We can also use Taylor series expansions to upper-bound other metrics, like JS Divergence and Hellinger Distance.</p><h1 class="mo mp jg bm mq mr ms mt mu mv mw mx my km mz kn na kp nb kq nc ks nd kt ne nf ga" id="f8ca">Conclusion</h1><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="0eac">That’s it for today! Hope you gained some insights about how to implement automated thresholds in a computationally and probabilistically sound manner! We implement these kinds of systems at Arthur AI, and a few equations can go a long way for the customer experience.</p><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="17a4">Happy monitoring!</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm oy"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*BKSVtk8iLpoae-98 640w, https://miro.medium.com/max/720/0*BKSVtk8iLpoae-98 720w, https://miro.medium.com/max/750/0*BKSVtk8iLpoae-98 750w, https://miro.medium.com/max/786/0*BKSVtk8iLpoae-98 786w, https://miro.medium.com/max/828/0*BKSVtk8iLpoae-98 828w, https://miro.medium.com/max/1100/0*BKSVtk8iLpoae-98 1100w, https://miro.medium.com/max/1400/0*BKSVtk8iLpoae-98 1400w"/><img alt="" class="ce lf lg c" height="468" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lh bl gn gl gm li lj bm b bn bo cn">Photo by <a class="au lk" href="https://unsplash.com/@pabloheimplatz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pablo Heimplatz</a> on <a class="au lk" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="o dx mh mi ii mj" role="separator"><span class="mk fl ci ml mm mn"></span><span class="mk fl ci ml mm mn"></span><span class="mk fl ci ml mm"></span></div><div class="iz ja jb jc jd"><h1 class="mo mp jg bm mq mr oh mt mu mv oi mx my km oj kn na kp ok kq nc ks ol kt ne nf ga" id="585b">Appendix: Delta Method Approximations</h1><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="60cd">Note that the first-order approximations for both sections below are upper bounds because the log function is concave.</p><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="ce57">log(X) Approximation</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="fef7">By a first-order Taylor series expansion around the mean,</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm oz"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 554px" srcset="https://miro.medium.com/max/640/1*Z8ut1J4H4gEnTCyS008_nw.png 640w, https://miro.medium.com/max/720/1*Z8ut1J4H4gEnTCyS008_nw.png 720w, https://miro.medium.com/max/750/1*Z8ut1J4H4gEnTCyS008_nw.png 750w, https://miro.medium.com/max/786/1*Z8ut1J4H4gEnTCyS008_nw.png 786w, https://miro.medium.com/max/828/1*Z8ut1J4H4gEnTCyS008_nw.png 828w, https://miro.medium.com/max/1100/1*Z8ut1J4H4gEnTCyS008_nw.png 1100w, https://miro.medium.com/max/1108/1*Z8ut1J4H4gEnTCyS008_nw.png 1108w"/><img alt="" class="ce lf lg c" height="156" loading="lazy" role="presentation" width="554"/></picture></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="3b37">Using this approximation, we have</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm pa"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 312px" srcset="https://miro.medium.com/max/640/1*nUxTtU3IFo7nF5eEhBq4yg.png 640w, https://miro.medium.com/max/720/1*nUxTtU3IFo7nF5eEhBq4yg.png 720w, https://miro.medium.com/max/750/1*nUxTtU3IFo7nF5eEhBq4yg.png 750w, https://miro.medium.com/max/786/1*nUxTtU3IFo7nF5eEhBq4yg.png 786w, https://miro.medium.com/max/828/1*nUxTtU3IFo7nF5eEhBq4yg.png 828w, https://miro.medium.com/max/1100/1*nUxTtU3IFo7nF5eEhBq4yg.png 1100w, https://miro.medium.com/max/624/1*nUxTtU3IFo7nF5eEhBq4yg.png 624w"/><img alt="" class="ce lf lg c" height="75" loading="lazy" role="presentation" width="312"/></picture></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="386d">and</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm pb"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/1*9yrf4OtoiAp9fPbzxCqiqw.png 640w, https://miro.medium.com/max/720/1*9yrf4OtoiAp9fPbzxCqiqw.png 720w, https://miro.medium.com/max/750/1*9yrf4OtoiAp9fPbzxCqiqw.png 750w, https://miro.medium.com/max/786/1*9yrf4OtoiAp9fPbzxCqiqw.png 786w, https://miro.medium.com/max/828/1*9yrf4OtoiAp9fPbzxCqiqw.png 828w, https://miro.medium.com/max/1100/1*9yrf4OtoiAp9fPbzxCqiqw.png 1100w, https://miro.medium.com/max/1400/1*9yrf4OtoiAp9fPbzxCqiqw.png 1400w"/><img alt="" class="ce lf lg c" height="289" loading="lazy" role="presentation" width="700"/></picture></div></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="7103">with inequality by Cauchy-Schwarz.</p><h2 class="ng mp jg bm mq nh ni nj mu nk nl nm my lu nn no na ly np nq nc mc nr ns ne nt ga" id="1789">Xlog(X)</h2><p class="pw-post-body-paragraph ll lm jg ln b lo nu kh lq lr nv kk lt lu nw lw lx ly nx ma mb mc ny me mf mg iz ga" id="d9bf">By a first-order Taylor series expansion around the mean,</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm pc"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/1*0hZtSlkjjGR_Xi-48hH-PQ.png 640w, https://miro.medium.com/max/720/1*0hZtSlkjjGR_Xi-48hH-PQ.png 720w, https://miro.medium.com/max/750/1*0hZtSlkjjGR_Xi-48hH-PQ.png 750w, https://miro.medium.com/max/786/1*0hZtSlkjjGR_Xi-48hH-PQ.png 786w, https://miro.medium.com/max/828/1*0hZtSlkjjGR_Xi-48hH-PQ.png 828w, https://miro.medium.com/max/1100/1*0hZtSlkjjGR_Xi-48hH-PQ.png 1100w, https://miro.medium.com/max/1400/1*0hZtSlkjjGR_Xi-48hH-PQ.png 1400w"/><img alt="" class="ce lf lg c" height="68" loading="lazy" role="presentation" width="700"/></picture></div></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="dd28">Using this approximation, we have</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm pd"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 569px" srcset="https://miro.medium.com/max/640/1*3WhdUJdXUSuWRGpwgroaEg.png 640w, https://miro.medium.com/max/720/1*3WhdUJdXUSuWRGpwgroaEg.png 720w, https://miro.medium.com/max/750/1*3WhdUJdXUSuWRGpwgroaEg.png 750w, https://miro.medium.com/max/786/1*3WhdUJdXUSuWRGpwgroaEg.png 786w, https://miro.medium.com/max/828/1*3WhdUJdXUSuWRGpwgroaEg.png 828w, https://miro.medium.com/max/1100/1*3WhdUJdXUSuWRGpwgroaEg.png 1100w, https://miro.medium.com/max/1138/1*3WhdUJdXUSuWRGpwgroaEg.png 1138w"/><img alt="" class="ce lf lg c" height="35" loading="lazy" role="presentation" width="569"/></picture></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="a255">and letting</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="gl gm pe"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 248px" srcset="https://miro.medium.com/max/640/1*cW-jgp5SSktk6WdnD2p6tA.png 640w, https://miro.medium.com/max/720/1*cW-jgp5SSktk6WdnD2p6tA.png 720w, https://miro.medium.com/max/750/1*cW-jgp5SSktk6WdnD2p6tA.png 750w, https://miro.medium.com/max/786/1*cW-jgp5SSktk6WdnD2p6tA.png 786w, https://miro.medium.com/max/828/1*cW-jgp5SSktk6WdnD2p6tA.png 828w, https://miro.medium.com/max/1100/1*cW-jgp5SSktk6WdnD2p6tA.png 1100w, https://miro.medium.com/max/496/1*cW-jgp5SSktk6WdnD2p6tA.png 496w"/><img alt="" class="ce lf lg c" height="78" loading="lazy" role="presentation" width="248"/></picture></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="9a48">we have</p><figure class="kw kx ky kz gx la gl gm paragraph-image"><div class="lb lc do ld ce le" role="button" tabindex="0"><div class="gl gm pf"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/1*8nTa1G_xRHrxop_rWSfMvA.png 640w, https://miro.medium.com/max/720/1*8nTa1G_xRHrxop_rWSfMvA.png 720w, https://miro.medium.com/max/750/1*8nTa1G_xRHrxop_rWSfMvA.png 750w, https://miro.medium.com/max/786/1*8nTa1G_xRHrxop_rWSfMvA.png 786w, https://miro.medium.com/max/828/1*8nTa1G_xRHrxop_rWSfMvA.png 828w, https://miro.medium.com/max/1100/1*8nTa1G_xRHrxop_rWSfMvA.png 1100w, https://miro.medium.com/max/1400/1*8nTa1G_xRHrxop_rWSfMvA.png 1400w"/><img alt="" class="ce lf lg c" height="133" loading="lazy" role="presentation" width="700"/></picture></div></div></figure><p class="pw-post-body-paragraph ll lm jg ln b lo lp kh lq lr ls kk lt lu lv lw lx ly lz ma mb mc md me mf mg iz ga" id="9cc3">with inequality by Cauchy-Schwarz.</p></div></div></section></div></div></article>