<article><div class="l"><div class="gg gh gi gj gk gl gm ce gn ch l"></div><div class="l"><header class="pw-post-byline-header go gp gq gr gs gt gu gv gw gx l"><div class="o gy u"><div class="o"><div class="fj l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@orenrazon?source=post_page-----13e0b8211a2f--------------------------------" rel="noopener follow"><div class="l do"><img alt="Oren Razon" class="l ch fl gz ha fp" height="48" loading="lazy" src="https://miro.medium.com/fit/c/96/96/1*jczpDqjdHefdyJuvsuqAXw.jpeg" width="48"/><div class="fk fl l gz ha fo aq"></div></div></a></div><div class="l"><div class="pw-author bm b dm dn ga"><div class="hb o hc"><div><div aria-hidden="false" class="ci"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@orenrazon?source=post_page-----13e0b8211a2f--------------------------------" rel="noopener follow">Oren Razon</a></div></div><div class="hd he hf hg hh d"><span><a class="bm b hi bo hj hk hl hm hn ho hp bd bz hq hr hs cd cf cg ch ci cj" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F10e98e64e8b6&amp;operation=register&amp;redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsafely-rolling-out-ml-models-to-production-13e0b8211a2f&amp;user=Oren+Razon&amp;userId=10e98e64e8b6&amp;source=post_page-10e98e64e8b6----13e0b8211a2f---------------------follow_byline-----------" rel="noopener follow">Follow</a></span></div></div></div><div class="o ao ht"><p class="pw-published-date bm b bn bo cn"><span>Nov 6, 2020</span></p><div aria-hidden="true" class="hu ci"><span aria-hidden="true" class="l"><span class="bm b bn bo cn">·</span></span></div><div class="pw-reading-time bm b bn bo cn">13 min read</div></div></div></div><div class="o ao"><div class="h k hv hw hx"><div class="hy l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on twitter" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M20 5.34c-.67.41-1.4.7-2.18.87a3.45 3.45 0 0 0-5.02-.1 3.49 3.49 0 0 0-1.02 2.47c0 .28.03.54.07.8a9.91 9.91 0 0 1-7.17-3.66 3.9 3.9 0 0 0-.5 1.74 3.6 3.6 0 0 0 1.56 2.92 3.36 3.36 0 0 1-1.55-.44V10c0 1.67 1.2 3.08 2.8 3.42-.3.06-.6.1-.94.12l-.62-.06a3.5 3.5 0 0 0 3.24 2.43 7.34 7.34 0 0 1-4.36 1.49l-.81-.05a9.96 9.96 0 0 0 5.36 1.56c6.4 0 9.91-5.32 9.9-9.9v-.5c.69-.49 1.28-1.1 1.74-1.81-.63.3-1.3.48-2 .56A3.33 3.33 0 0 0 20 5.33" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="hy l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on facebook" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M19.75 12.04c0-4.3-3.47-7.79-7.75-7.79a7.77 7.77 0 0 0-5.9 12.84 7.77 7.77 0 0 0 4.69 2.63v-5.49h-1.9v-2.2h1.9v-1.62c0-1.88 1.14-2.9 2.8-2.9.8 0 1.49.06 1.69.08v1.97h-1.15c-.91 0-1.1.43-1.1 1.07v1.4h2.17l-.28 2.2h-1.88v5.52a7.77 7.77 0 0 0 6.7-7.71" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="hy l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on linkedin" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M19.75 5.39v13.22a1.14 1.14 0 0 1-1.14 1.14H5.39a1.14 1.14 0 0 1-1.14-1.14V5.39a1.14 1.14 0 0 1 1.14-1.14h13.22a1.14 1.14 0 0 1 1.14 1.14zM8.81 10.18H6.53v7.3H8.8v-7.3zM9 7.67a1.31 1.31 0 0 0-1.3-1.32h-.04a1.32 1.32 0 0 0 0 2.64A1.31 1.31 0 0 0 9 7.71v-.04zm8.46 5.37c0-2.2-1.4-3.05-2.78-3.05a2.6 2.6 0 0 0-2.3 1.18h-.07v-1h-2.14v7.3h2.28V13.6a1.51 1.51 0 0 1 1.36-1.63h.09c.72 0 1.26.45 1.26 1.6v3.91h2.28l.02-4.43z" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="l fr"><div><div aria-hidden="false" class="ci"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path clip-rule="evenodd" d="M3.57 14.67c0-.57.13-1.11.38-1.6l.02-.02v-.02l.02-.02c0-.02 0-.02.02-.02.12-.26.3-.52.57-.8L7.78 9v-.02l.01-.02c.44-.41.91-.7 1.44-.85a4.87 4.87 0 0 0-1.19 2.36A5.04 5.04 0 0 0 8 11.6L6.04 13.6c-.19.19-.32.4-.38.65a2 2 0 0 0 0 .9c.08.2.2.4.38.57l1.29 1.31c.27.28.62.42 1.03.42.42 0 .78-.14 1.06-.42l1.23-1.25.79-.78 1.15-1.16c.08-.09.19-.22.28-.4.1-.2.15-.42.15-.67 0-.16-.02-.3-.06-.45l-.02-.02v-.02l-.07-.14s0-.03-.04-.06l-.06-.13-.02-.02c0-.02 0-.03-.02-.05a.6.6 0 0 0-.14-.16l-.48-.5c0-.04.02-.1.04-.15l.06-.12 1.17-1.14.09-.09.56.57c.02.04.08.1.16.18l.05.04.03.06.04.05.03.04.04.06.1.14.02.02c0 .02.01.03.03.04l.1.2v.02c.1.16.2.38.3.68a1 1 0 0 1 .04.25 3.2 3.2 0 0 1 .02 1.33 3.49 3.49 0 0 1-.95 1.87l-.66.67-.97.97-1.56 1.57a3.4 3.4 0 0 1-2.47 1.02c-.97 0-1.8-.34-2.49-1.03l-1.3-1.3a3.55 3.55 0 0 1-1-2.51v-.01h-.02v.02zm5.39-3.43c0-.19.02-.4.07-.63.13-.74.44-1.37.95-1.87l.66-.67.97-.98 1.56-1.56c.68-.69 1.5-1.03 2.47-1.03.97 0 1.8.34 2.48 1.02l1.3 1.32a3.48 3.48 0 0 1 1 2.48c0 .58-.11 1.11-.37 1.6l-.02.02v.02l-.02.04c-.14.27-.35.54-.6.8L16.23 15l-.01.02-.01.02c-.44.42-.92.7-1.43.83a4.55 4.55 0 0 0 1.23-3.52L18 10.38c.18-.21.3-.42.35-.65a2.03 2.03 0 0 0-.01-.9 1.96 1.96 0 0 0-.36-.58l-1.3-1.3a1.49 1.49 0 0 0-1.06-.42c-.42 0-.77.14-1.06.4l-1.2 1.27-.8.8-1.16 1.15c-.08.08-.18.21-.29.4a1.66 1.66 0 0 0-.08 1.12l.02.03v.02l.06.14s.01.03.05.06l.06.13.02.02.01.02.01.02c.05.08.1.13.14.16l.47.5c0 .04-.02.09-.04.15l-.06.12-1.15 1.15-.1.08-.56-.56a2.3 2.3 0 0 0-.18-.19c-.02-.01-.02-.03-.02-.04l-.02-.02a.37.37 0 0 1-.1-.12c-.03-.03-.05-.04-.05-.06l-.1-.15-.02-.02-.02-.04-.08-.17v-.02a5.1 5.1 0 0 1-.28-.69 1.03 1.03 0 0 1-.04-.26c-.06-.23-.1-.46-.1-.7v.01z" fill="#A8A8A8" fill-rule="evenodd"></path></svg></span></button></div></div></div><div class="ib o ao"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F13e0b8211a2f&amp;operation=register&amp;redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsafely-rolling-out-ml-models-to-production-13e0b8211a2f&amp;source=--------------------------bookmark_header-----------" rel="noopener follow"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" class="au de aw ax ay az ba hz bc id ie if ig"><svg aria-label="Add to list bookmark button" class="ic" fill="none" height="25" viewbox="0 0 25 25" width="25"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></button></a></span></div></div><div class="ck ih"><div><div aria-hidden="false" class="ci"></div></div></div></div></div><div class="ii ij ik j i d"><div class="fj l"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F13e0b8211a2f&amp;operation=register&amp;redirect=https%3A%2F%2Ftowardsdatascience.com%2Fsafely-rolling-out-ml-models-to-production-13e0b8211a2f&amp;source=--------------------------bookmark_header-----------" rel="noopener follow"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" class="au de aw il ay az ba im bc id cd o ao in io ig"><svg aria-label="Add to list bookmark button" class="ic" fill="none" height="25" viewbox="0 0 25 25" width="25"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg><p class="bm b bn bo cn">Save</p></button></a></span></div><div class="ip l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on twitter" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M20 5.34c-.67.41-1.4.7-2.18.87a3.45 3.45 0 0 0-5.02-.1 3.49 3.49 0 0 0-1.02 2.47c0 .28.03.54.07.8a9.91 9.91 0 0 1-7.17-3.66 3.9 3.9 0 0 0-.5 1.74 3.6 3.6 0 0 0 1.56 2.92 3.36 3.36 0 0 1-1.55-.44V10c0 1.67 1.2 3.08 2.8 3.42-.3.06-.6.1-.94.12l-.62-.06a3.5 3.5 0 0 0 3.24 2.43 7.34 7.34 0 0 1-4.36 1.49l-.81-.05a9.96 9.96 0 0 0 5.36 1.56c6.4 0 9.91-5.32 9.9-9.9v-.5c.69-.49 1.28-1.1 1.74-1.81-.63.3-1.3.48-2 .56A3.33 3.33 0 0 0 20 5.33" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="ip l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on facebook" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M19.75 12.04c0-4.3-3.47-7.79-7.75-7.79a7.77 7.77 0 0 0-5.9 12.84 7.77 7.77 0 0 0 4.69 2.63v-5.49h-1.9v-2.2h1.9v-1.62c0-1.88 1.14-2.9 2.8-2.9.8 0 1.49.06 1.69.08v1.97h-1.15c-.91 0-1.1.43-1.1 1.07v1.4h2.17l-.28 2.2h-1.88v5.52a7.77 7.77 0 0 0 6.7-7.71" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="ip l fr"><div><div aria-hidden="false" class="ci"><button aria-label="Share on linkedin" class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path d="M19.75 5.39v13.22a1.14 1.14 0 0 1-1.14 1.14H5.39a1.14 1.14 0 0 1-1.14-1.14V5.39a1.14 1.14 0 0 1 1.14-1.14h13.22a1.14 1.14 0 0 1 1.14 1.14zM8.81 10.18H6.53v7.3H8.8v-7.3zM9 7.67a1.31 1.31 0 0 0-1.3-1.32h-.04a1.32 1.32 0 0 0 0 2.64A1.31 1.31 0 0 0 9 7.71v-.04zm8.46 5.37c0-2.2-1.4-3.05-2.78-3.05a2.6 2.6 0 0 0-2.3 1.18h-.07v-1h-2.14v7.3h2.28V13.6a1.51 1.51 0 0 1 1.36-1.63h.09c.72 0 1.26.45 1.26 1.6v3.91h2.28l.02-4.43z" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="l fr"><div><div aria-hidden="false" class="ci"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hz dw ia"><svg fill="none" height="24" viewbox="0 0 24 24" width="24"><path clip-rule="evenodd" d="M3.57 14.67c0-.57.13-1.11.38-1.6l.02-.02v-.02l.02-.02c0-.02 0-.02.02-.02.12-.26.3-.52.57-.8L7.78 9v-.02l.01-.02c.44-.41.91-.7 1.44-.85a4.87 4.87 0 0 0-1.19 2.36A5.04 5.04 0 0 0 8 11.6L6.04 13.6c-.19.19-.32.4-.38.65a2 2 0 0 0 0 .9c.08.2.2.4.38.57l1.29 1.31c.27.28.62.42 1.03.42.42 0 .78-.14 1.06-.42l1.23-1.25.79-.78 1.15-1.16c.08-.09.19-.22.28-.4.1-.2.15-.42.15-.67 0-.16-.02-.3-.06-.45l-.02-.02v-.02l-.07-.14s0-.03-.04-.06l-.06-.13-.02-.02c0-.02 0-.03-.02-.05a.6.6 0 0 0-.14-.16l-.48-.5c0-.04.02-.1.04-.15l.06-.12 1.17-1.14.09-.09.56.57c.02.04.08.1.16.18l.05.04.03.06.04.05.03.04.04.06.1.14.02.02c0 .02.01.03.03.04l.1.2v.02c.1.16.2.38.3.68a1 1 0 0 1 .04.25 3.2 3.2 0 0 1 .02 1.33 3.49 3.49 0 0 1-.95 1.87l-.66.67-.97.97-1.56 1.57a3.4 3.4 0 0 1-2.47 1.02c-.97 0-1.8-.34-2.49-1.03l-1.3-1.3a3.55 3.55 0 0 1-1-2.51v-.01h-.02v.02zm5.39-3.43c0-.19.02-.4.07-.63.13-.74.44-1.37.95-1.87l.66-.67.97-.98 1.56-1.56c.68-.69 1.5-1.03 2.47-1.03.97 0 1.8.34 2.48 1.02l1.3 1.32a3.48 3.48 0 0 1 1 2.48c0 .58-.11 1.11-.37 1.6l-.02.02v.02l-.02.04c-.14.27-.35.54-.6.8L16.23 15l-.01.02-.01.02c-.44.42-.92.7-1.43.83a4.55 4.55 0 0 0 1.23-3.52L18 10.38c.18-.21.3-.42.35-.65a2.03 2.03 0 0 0-.01-.9 1.96 1.96 0 0 0-.36-.58l-1.3-1.3a1.49 1.49 0 0 0-1.06-.42c-.42 0-.77.14-1.06.4l-1.2 1.27-.8.8-1.16 1.15c-.08.08-.18.21-.29.4a1.66 1.66 0 0 0-.08 1.12l.02.03v.02l.06.14s.01.03.05.06l.06.13.02.02.01.02.01.02c.05.08.1.13.14.16l.47.5c0 .04-.02.09-.04.15l-.06.12-1.15 1.15-.1.08-.56-.56a2.3 2.3 0 0 0-.18-.19c-.02-.01-.02-.03-.02-.04l-.02-.02a.37.37 0 0 1-.1-.12c-.03-.03-.05-.04-.05-.06l-.1-.15-.02-.02-.02-.04-.08-.17v-.02a5.1 5.1 0 0 1-.28-.69 1.03 1.03 0 0 1-.04-.26c-.06-.23-.1-.46-.1-.7v.01z" fill="#A8A8A8" fill-rule="evenodd"></path></svg></span></button></div></div></div></div></header><span class="l"></span><section><div><div class="fo as iv iw ix iy"></div><div class="iz ja jb jc jd"><h2 aria-label="kicker paragraph" class="je jf jg bm b hi jh ji jj jk jl jm cn jn" id="0b0a"><a class="au cj" href="https://towardsdatascience.com/tagged/making-sense-of-big-data" rel="noopener" target="_blank">Making Sense of Big Data</a></h2><div class=""><h1 class="pw-post-title jo jp jg bm jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ga" id="688a">Safely Rolling Out ML Models To Production</h1></div><div class=""><h2 class="pw-subtitle-paragraph km jp jg bm b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld cn" id="07b6">Best CI/CD practices for the painless deployment of machine learning models and versions</h2></div><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm le"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*zasnahAKUxpVRNQh 640w, https://miro.medium.com/max/720/0*zasnahAKUxpVRNQh 720w, https://miro.medium.com/max/750/0*zasnahAKUxpVRNQh 750w, https://miro.medium.com/max/786/0*zasnahAKUxpVRNQh 786w, https://miro.medium.com/max/828/0*zasnahAKUxpVRNQh 828w, https://miro.medium.com/max/1100/0*zasnahAKUxpVRNQh 1100w, https://miro.medium.com/max/1400/0*zasnahAKUxpVRNQh 1400w"/><img alt="" class="ce lo lp c" height="359" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">Orchestrating different (non ML) instruments. Source: Unsplash</figcaption></figure><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="0860">For any data scientist, the day you roll out your model’s new version to production is a day of mixed feelings. On the one hand, you are releasing a new version that is geared towards yielding better results and making a greater impact; on the other, this is a rather scary and tense time. Your new shiny version may contain flaws that you will only be able to detect after they have had a negative impact.</p><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="a928"><em class="jg">ML is as complex as orchestrating different instruments</em></p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="5f0c">Replacing or publishing a new version to production touches upon the core decision making logic of your business process. With AI adoption rising, the necessity to automatically publish and update models is becoming a common and frequent task, which makes it a top concern for data science teams.</p><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="48ec"><strong class="lv jq">In this article, I will review what makes the rollout of a new version so sensitive, what precautions are required, and how to leverage monitoring to optimize your Continuous Integration (CI) pipeline, as well as your Continuous Deployment (CD) one to safely achieve your goals.</strong></p></div><div class="o dx mw mx ii my" role="separator"><span class="mz fl ci na nb nc"></span><span class="mz fl ci na nb nc"></span><span class="mz fl ci na nb"></span></div><div class="iz ja jb jc jd"><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="2c94">ML systems are composed of multiple moving and independent parts of software that need to work in tune with each other:</p><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm nd"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*Xxc-ozRGdqsB3kTD 640w, https://miro.medium.com/max/720/0*Xxc-ozRGdqsB3kTD 720w, https://miro.medium.com/max/750/0*Xxc-ozRGdqsB3kTD 750w, https://miro.medium.com/max/786/0*Xxc-ozRGdqsB3kTD 786w, https://miro.medium.com/max/828/0*Xxc-ozRGdqsB3kTD 828w, https://miro.medium.com/max/1100/0*Xxc-ozRGdqsB3kTD 1100w, https://miro.medium.com/max/1400/0*Xxc-ozRGdqsB3kTD 1400w"/><img alt="" class="ce lo lp c" height="323" loading="eager" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">The “ML orchestra”. Image by author</figcaption></figure><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="b533"><strong class="lv jq">Training pipeline</strong>: Includes all processing steps that leverage your historical dataset to produce a working model: data pre-processing, such as embeddings, scaling, feature engineering, feature selection or dimensionality reduction, hyperparameter tuning, and performance evaluation using cross-validation or hold out sets.</p><ul class=""><li class="ne nf jg lv b lw lx lz ma mc ng mg nh mk ni mo nj nk nl nm ga" id="ff6f"><strong class="lv jq">Model registry</strong>: A deployed model can take various forms: specific object serialization such as pickle, or cross-technology serialization formats such as PMML. Usually, these files are kept in a registry-based on shared file storage (S3, GCS,…), in a standard version repository (git) or in a dedicated service such as <a class="au nn" href="https://mlflow.org/docs/latest/model-registry.html" rel="noopener ugc nofollow" target="_blank">MLFlow model registry</a>.</li><li class="ne nf jg lv b lw no lz np mc nq mg nr mk ns mo nj nk nl nm ga" id="6e68"><strong class="lv jq">Serving layer</strong>: This is the actual prediction service. Such layers can be embedded together with the business logic of the application that rely on the model predictions or can be separated to act as a prediction service decoupled from the business processes it supports. In both cases, the core functionality is to retrieve the relevant predictions according to new incoming requests, using models from the model registry. Such a service can work in a batch or stream manner.</li><li class="ne nf jg lv b lw no lz np mc nq mg nr mk ns mo nj nk nl nm ga" id="9b38"><strong class="lv jq">Label collection</strong>: A process that collects the ground truth for supervised learning cases. It can be done manually, automatically, or using a mixed approach such as active learning.</li><li class="ne nf jg lv b lw no lz np mc nq mg nr mk ns mo nj nk nl nm ga" id="fc92"><strong class="lv jq">Monitoring</strong>: A centralized service that monitors the entire process and health of your live models, from the quality of inputs that get into the serving and up to the collected labels to detect drift, biases, or integrity issues.</li></ul><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="ce62">Given this relatively high-level and complex orchestration, many things can get out of sync and lead us to deploy an underperforming model. Some of the most common culprits are:</p><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="504b">1. Lack of automation</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="7a91">Most organizations are still manually updating their models. Whether it is the training pipeline or parts of it, such as features selection, or the delivery and promotion of the newly created model by the serving layer; doing so manually can lead to errors and unnecessary overheads.</p><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="c5e5">2. A multiplicity of stakeholders</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="bb4d">As a plurality of stakeholders and experts are involved, there are more handovers and thus more room for misunderstandings and integration issues. While the data scientists design the flows, the ML Engineers are usually doing the coding — and without being fully aligned (e.g. using different scaling methods), this may result in having unintentional behaviors.</p><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="d267">3. Hyper-dynamism of real-life data</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="cfa1">The empirical research is done in an offline lab environment, with historical datasets, and by simulating hold out testings. Needless to say, these environments are very different from the production one, for which only parts of the data are actually available. This might lead to data leakages or wrong assumptions that lead to bad performance, bias, or problematic code behavior once the model is in production and needs to serve live data streams. For instance, the newly deployed version’s inability to handle new values in a categorical feature while pre-processing it into an embedded vector during the inference phase.</p><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="ccd9">4. Silent failures of ML models vs. traditional IT monitoring</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="b9be">Monitoring ML is more complex than monitoring traditional software — the fact that the entire system is working doesn’t mean it actually does what it should do. Without proper dedicated ml monitoring service in place, such failures can go “silently” and “under the radar” until the business damage was already done. You can read more on <a class="au nn" href="/monitor-stop-being-a-blind-data-scientist-ac915286075f" rel="noopener" target="_blank">what does it take to monitor ml models</a> and <a class="au nn" href="https://www.superwise.ai/resources/thinking-about-building-your-own-ml-monitoring-solution-answer-these-questions-first" rel="noopener ugc nofollow" target="_blank">whether you should build it yourself</a>.</p><h1 class="os nu jg bm nv ot ou ov nz ow ox oy od kv oz kw og ky pa kz oj lb pb lc om pc ga" id="0dc8">CIֿֿֿ/CD for ML in production</h1><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="6416">CI practices are about frequently testing the code bases of each of the software units, and the integrity of the different software artifacts working together by using unit/integration/system tests.</p><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="f65c"><em class="jg">A new model version should be considered and treated as a software artifact</em></p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="2f9a">The creation of a new model requires a set of unit and integration tests to ensure that the new “candidate” model is valid before it is committed into the model registry. <strong class="lv jq">But in the ML realms, CI is not only about testing and validating code and components, but also testing and validating data, data schemas, and model quality</strong>. While the focus of CI is to maintain valid code bases and modules’ artifacts, before building new artifacts for each module, the CD process handles the phase of actually deploying the artifacts (in our case, the new model version) into production.</p><h1 class="os nu jg bm nv ot ou ov nz ow ox oy od kv oz kw og ky pa kz oj lb pb lc om pc ga" id="8da9">Best Practices for the CI phase</h1><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="d872">Here are some of the main best practices for the CI phase that impact the safe rollout of model/new version implementations:</p><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="88e2">Data validation</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="bc35">Models are retrained/produced using historical data. For the model to be relevant in production, the training data set should adequately represent the data distribution that currently appears in production. This will avoid selection bias or simply irrelevance. To do so, before even starting the training pipeline, the distribution of the training set should be tested to ensure that it is fit for the task. At this stage, the monitoring solution can be leveraged to provide detailed reports on the distributions of the last production cases, and by using data testing tools such as <a class="au nn" href="https://github.com/awslabs/deequ" rel="noopener ugc nofollow" target="_blank">deequ</a> or <a class="au nn" href="https://github.com/tdda/tdda" rel="noopener ugc nofollow" target="_blank">TDDA</a>, this type of data verification constraints can be automatically added to the CI process.</p><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm le"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*gF7HQgGxrh_FXvE_ 640w, https://miro.medium.com/max/720/0*gF7HQgGxrh_FXvE_ 720w, https://miro.medium.com/max/750/0*gF7HQgGxrh_FXvE_ 750w, https://miro.medium.com/max/786/0*gF7HQgGxrh_FXvE_ 786w, https://miro.medium.com/max/828/0*gF7HQgGxrh_FXvE_ 828w, https://miro.medium.com/max/1100/0*gF7HQgGxrh_FXvE_ 1100w, https://miro.medium.com/max/1400/0*gF7HQgGxrh_FXvE_ 1400w"/><img alt="" class="ce lo lp c" height="293" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">Extracting data distributions from production using the monitoring service and comparing them to your training dataset (image taken from superwise.ai system)</figcaption></figure><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="c360">Model quality validation</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="6f90">When executing the training pipeline and before submitting the new model as a “candidate” model into the registry, ensure that the new training process undergoes a healthy fit verification.</p><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="a455"><em class="jg">Even if the training pipeline is fully automated, it should include a hold-out/cross-validation model evaluation step.</em></p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="4a2d">Given the selected validation method, one should apply tests to validate that the fitted model convergence doesn’t indicate overfitting, i.e.: seeing a reduced loss on the training dataset, while it’s increasing on the validation set. The performance should also be above a certain minimal rate — based on a hardcoded threshold, naive model as a baseline, or calculated dynamically by leveraging the monitoring service and extracting the rates of the production model during the used validation set.</p><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm pd"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/1*R0v-QGkDA0pVqEH19xlANQ.png 640w, https://miro.medium.com/max/720/1*R0v-QGkDA0pVqEH19xlANQ.png 720w, https://miro.medium.com/max/750/1*R0v-QGkDA0pVqEH19xlANQ.png 750w, https://miro.medium.com/max/786/1*R0v-QGkDA0pVqEH19xlANQ.png 786w, https://miro.medium.com/max/828/1*R0v-QGkDA0pVqEH19xlANQ.png 828w, https://miro.medium.com/max/1100/1*R0v-QGkDA0pVqEH19xlANQ.png 1100w, https://miro.medium.com/max/1400/1*R0v-QGkDA0pVqEH19xlANQ.png 1400w"/><img alt="" class="ce lo lp c" height="205" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">Cross-validation evaluation setup example. Image by author</figcaption></figure><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="78af">Test cases — Robustness for production data assumptions</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="b38b">Once the model quality validation phase is completed, one should perform integration tests to see how the serving layer integrates with the new version, and whether it successfully serves predictions for specific edge cases. For instance: handling null values in the features that could be nullable, handling new categorical levels in categorical features, working on different lengths of text for text inputs, or even working for different image size/resolution,… Here also, the examples can be synthesized manually or taken from the monitoring solution, whose capabilities include identifying and saving valid inputs with data integrity issues.</p><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="1f18">Model stress test</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="2c98">Changing the model, or changing its pre-processing steps or packages could also impact the model’s operational performance. In many use cases such as real time-bidding increasing the latency of the model serving might impact dramatically the business. Therefore, as a final step in the model CI process, a stress test should be performed to measure the operational aspects, such as average response time. Such a metric can be evaluated relative to a business constraint or relative to the current production operational model latency, calculated by the monitoring solution.</p><h1 class="os nu jg bm nv ot ou ov nz ow ox oy od kv oz kw og ky pa kz oj lb pb lc om pc ga" id="b817">Best Practices for the CD phase</h1><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="7d34">The CD phase is the process of actually deploying the code to replace the previous versions. In traditional software engineering, this is usually carried out through a “<a class="au nn" href="https://martinfowler.com/bliki/BlueGreenDeployment.html" rel="noopener ugc nofollow" target="_blank">Blue-green</a>” or a “<a class="au nn" href="https://martinfowler.com/bliki/CanaryRelease.html" rel="noopener ugc nofollow" target="_blank">canary</a>” deployment — a methodology for gradually rolling out releases. First, the change is deployed to a small subset of cases, usually rolling out gradually to a subset of servers. Once it is established that the functionality works well, the change is then rolled out to the rest of the servers.</p><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="36a6"><strong class="lv jq">Applying it to ML models, the CD process should basically be a gradual one to validate the model correctness and quality on live data, using production systems, before letting it kick in and take real automated decisions.</strong> Such evaluation is often called “online evaluation”, as opposed to the tests achieved during the CI phase which are based on historical datasets and may be considered to be “offline evaluation”.</p><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm pe"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*vV_5Br9BvfRkWOX_ 640w, https://miro.medium.com/max/720/0*vV_5Br9BvfRkWOX_ 720w, https://miro.medium.com/max/750/0*vV_5Br9BvfRkWOX_ 750w, https://miro.medium.com/max/786/0*vV_5Br9BvfRkWOX_ 786w, https://miro.medium.com/max/828/0*vV_5Br9BvfRkWOX_ 828w, https://miro.medium.com/max/1100/0*vV_5Br9BvfRkWOX_ 1100w, https://miro.medium.com/max/1400/0*vV_5Br9BvfRkWOX_ 1400w"/><img alt="" class="ce lo lp c" height="170" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">The full CI/CD model lifecycle. Image by author</figcaption></figure><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="8327">Such model online evaluation may involve a few basic strategies:</p><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="60f7">Shadow evaluation</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="a8cd">Shadow evaluation (or often called “Dark launch”) is a very intuitive and safe strategy. In shadow mode, the new model is added to the registry as a “candidate model”. Any new prediction request is inferred both by the model versions, the one that currently used in production, and the new candidate version in shadow mode.</p><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="1adf"><em class="jg">In shadow mode the new version is tested using a new stream of production data, but only the predictions of the latest “production model” version are being used and returned to the user/business.</em></p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="d926">With shadow mode, there is no risk of exposure until the new version is indeed approved and works as expected. The benefits of the shadow mode are twofold:</p><ol class=""><li class="ne nf jg lv b lw lx lz ma mc ng mg nh mk ni mo pf nk nl nm ga" id="ac31">The performance of the new version is evaluated before it is “live”,</li><li class="ne nf jg lv b lw no lz np mc nq mg nr mk ns mo pf nk nl nm ga" id="1f7a">You ensure that the new version works well in the production pipelines</li></ol><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="e093">With this method, the monitoring service should persist through both sets of predictions — and continuously monitor both models until the new model is stable enough to be promoted as the new “production version”. Once the new version is ready, the monitoring service signals to the serving layer that it needs to upgrade the model version. Technically this “promotion” can be done by updating a tag of “latest” for the new version and making the serving layer always work with the “latest” model version tag (similar to the “latest” concept in docker images). Or by working with an explicit model version tag, but this will require the serving layer to always check first what is the latest production-ready version tag, and only then to reload the relevant version and use it to perform predictions.</p><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm pg"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*5396EGuDSnERn6tO.png 640w, https://miro.medium.com/max/720/0*5396EGuDSnERn6tO.png 720w, https://miro.medium.com/max/750/0*5396EGuDSnERn6tO.png 750w, https://miro.medium.com/max/786/0*5396EGuDSnERn6tO.png 786w, https://miro.medium.com/max/828/0*5396EGuDSnERn6tO.png 828w, https://miro.medium.com/max/1100/0*5396EGuDSnERn6tO.png 1100w, https://miro.medium.com/max/1400/0*5396EGuDSnERn6tO.png 1400w"/><img alt="" class="ce lo lp c" height="401" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">The monitoring service is responsible for deciding when to promote the shadow model. Image by author</figcaption></figure><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="05f0">We should compare the new “shadow” version to the current latest production model, using statistical hypothesis</p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="6c98">Such a test should verify that the performance of the new version has the required effect size, a.k.a: the difference between the two version performance metrics, under a specific statistical power, a.k.a.: the probability of correctly identifying an effect when there is one. For example: If the latest version had a precision level of 91% in the past week, the new candidate version must have a 0 or more effect size so the new precision rate will be 91% at least.</p><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="f09d"><em class="jg">The overall performance level is not the only metric to look at</em></p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="ef0c">Before promoting the model though, additional factors could be important to monitor: the performance stability, meaning determining the variance in the daily precision performance in our last example, or checking performance constraints for specific sub-population. E.g. the model must have a 95% precision level at least for our “VIP customers. When the label collection takes time or might be missing completely, other KPIs can be used to test the new model as a proxy for its quality — i.e.: in loan approval use cases, where such feedback loops might take longer than 3–6 months. In these cases, the level of correlation between the predictions of the two versions can be used, as a new version should have a relatively high level of correlation relative to its predecessor. Another option is to test the level of distribution shift in the production data relative to its training dataset to ensure that the new version was trained on a relevant dataset relative to the current production distribution.</p><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="770f">Aside from all its benefits, shadow evaluation has limitations and is only partially practical. This is what we will analyze below, as well as review alternative solutions.</p><h2 class="nt nu jg bm nv nw nx ny nz oa ob oc od mc oe of og mg oh oi oj mk ok ol om jm ga" id="082e">A/B Evaluation</h2><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="9ee0">In many ML scenarios, the predictions of the model actually impact the surrounding environment it operates in. Let’s take a recommendation model responsible for ranking the top 5 movie suggestions to offer. In most cases, the label depends on whether or not the user indeed watched one of the movies suggested. Here, the model’s prediction impacted the user’s behavior, and therefore the collected data. If a candidate shadow model outputs 5 very different movies, the fact that the user doesn’t select them doesn’t necessarily mean that they were bad recommendations — only the fact that the model was in shadow mode, and didn’t take any real-life action, made it impossible for the user to actually see these movies. In this scenario, the performance success cannot be compared. This is when an online A/B test evaluation is required.</p><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="9aba">In an A/B setup, both the current latest version and the new candidate version, which may be referred to as model A / “control” group and model B / “treatment” group, are actually active in production. Each new request is routed to one of the models, according to a specific logic, and only the selected model is used for prediction.</p><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm ph"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*GV25b7YUOE1KMZf2 640w, https://miro.medium.com/max/720/0*GV25b7YUOE1KMZf2 720w, https://miro.medium.com/max/750/0*GV25b7YUOE1KMZf2 750w, https://miro.medium.com/max/786/0*GV25b7YUOE1KMZf2 786w, https://miro.medium.com/max/828/0*GV25b7YUOE1KMZf2 828w, https://miro.medium.com/max/1100/0*GV25b7YUOE1KMZf2 1100w, https://miro.medium.com/max/1400/0*GV25b7YUOE1KMZf2 1400w"/><img alt="" class="ce lo lp c" height="318" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">A/B Routing example. Image by author</figcaption></figure><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="2e1b">These evaluations can be carried out for a certain amount of time, predictions, or until the statistical hypothesis — whether the new version is at least as good as the previous one — is validated. Similar to the shadow strategy, the KPIs to test can be the performance, stability or some other proxy,…It is important to note though, that the monitoring service should be in charge of the management and evaluation of the A/B tests.</p><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="619d"><em class="jg">The success of this method highly depends on the ability to split the A/B test groups correctly and carefully.</em></p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="85fa">A good practice for it is to do a random sample for a specific portion to get the “treatment”, meaning the prediction from the new version. For example, with the movie recommendation use case, any new request should have X (e.g. 10%) chance to be served by the new model version, until the test is done. Usually, the exposure factor is relatively low, as this strategy actually “exposes” the new model even before the qualitative tests are completed.</p><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="1619">Such A/B configuration can be generalized also to A/B/C/… setups — where multiple models are compared simultaneously. Keep in mind though that testing a few models together side-by-side can increase the chances for False-Positive outcome, due to the higher number of tests. Besides, given the fact that we are testing a smaller amount of samples in each group, the statistical power of “small effect size” is reduced, and therefore should be considered carefully.</p><h1 class="os nu jg bm nv ot ou ov nz ow ox oy od kv oz kw og ky pa kz oj lb pb lc om pc ga" id="7777">Multi-armed bandit</h1><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="d65c">Multi-armed bandit (MAB) is actually a more “dynamic” kind of A/B test experimentation, but also a more complex one to measure and operate. It’s a classical reinforcement learning where one tries to “explore” (try a new model version) while “exploiting” and optimizing the defined performance KPI. Such configuration is based on the implementation of the exploration/exploitation tradeoff inside the monitoring service. The traffic is being dynamically allocated between the two (or more) versions, according to the collected performance KPI — or other proxies as described earlier.</p><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="d72a">In this situation, the new version is exposed to a certain amount of cases. The more it equals or surpasses the previous version, and based on its performance KPI, more and more traffic will be directed to it.</p><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm pi"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*hX6OC29M8NJRmvUz 640w, https://miro.medium.com/max/720/0*hX6OC29M8NJRmvUz 720w, https://miro.medium.com/max/750/0*hX6OC29M8NJRmvUz 750w, https://miro.medium.com/max/786/0*hX6OC29M8NJRmvUz 786w, https://miro.medium.com/max/828/0*hX6OC29M8NJRmvUz 828w, https://miro.medium.com/max/1100/0*hX6OC29M8NJRmvUz 1100w, https://miro.medium.com/max/1400/0*hX6OC29M8NJRmvUz 1400w"/><img alt="" class="ce lo lp c" height="370" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">Dynamic multi-arm bandit routing based on monitored results. Image by author</figcaption></figure><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="cb4f">Such configuration seems ideal, as we try to optimize the “exposure” dynamically while optimizing our main metric. However, it requires advanced monitoring and automation capabilities to implement the multi-armed bandit solution, and adjust the traffic dynamically based on its results. Especially given the difficulties related to the definition of one clear KPI to be exploited by the system — performance, stability,...</p><h1 class="os nu jg bm nv ot ou ov nz ow ox oy od kv oz kw og ky pa kz oj lb pb lc om pc ga" id="53bb">The virtue of monitoring for safe rollouts</h1><p class="pw-post-body-paragraph lt lu jg lv b lw on kq ly lz oo kt mb mc op me mf mg oq mi mj mk or mm mn mo iz ga" id="9f1b">By looking at the examples used in traditional software and implementing that onto our own ML paradigm, CI/CD best practices, we learn that there are many steps to be taken to have a better “roll out day”. All of these strategies rely on a strong monitoring component to make the processes more data-driven.</p><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="9808"><em class="jg">Safely rolling out models is about monitoring the orchestration of all the pieces of the ML infrastructure together</em></p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="5b57">Below we can see the safe delivery of a new version (V2, marked as a blue dot), yielding an improved ROC AUC performance in production.</p><figure class="lf lg lh li gx lj gl gm paragraph-image"><div class="lk ll do lm ce ln" role="button" tabindex="0"><div class="gl gm le"><picture><source data-testid="og" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" srcset="https://miro.medium.com/max/640/0*MTI9YKLphD477i28 640w, https://miro.medium.com/max/720/0*MTI9YKLphD477i28 720w, https://miro.medium.com/max/750/0*MTI9YKLphD477i28 750w, https://miro.medium.com/max/786/0*MTI9YKLphD477i28 786w, https://miro.medium.com/max/828/0*MTI9YKLphD477i28 828w, https://miro.medium.com/max/1100/0*MTI9YKLphD477i28 1100w, https://miro.medium.com/max/1400/0*MTI9YKLphD477i28 1400w"/><img alt="" class="ce lo lp c" height="264" loading="lazy" role="presentation" width="700"/></picture></div></div><figcaption class="lq bl gn gl gm lr ls bm b bn bo cn">Screenshot of model monitored by superwise.ai</figcaption></figure><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="7bba">Looking beyond, the health of your models in production also requires a thorough, and data-driven retraining strategy. While, the CI/CD paradigms address the “what” and the “how” of new models roll-out, the “when” is covered by the CT (Continuous Training) paradigm. This will be the focus in the next post of my colleague <a class="au nn" href="https://medium.com/u/4b1a8c1d089a?source=post_page-----fd90478f97fc--------------------------------" rel="noopener">Or Itzahary</a>, so stay tuned!</p><blockquote class="mp mq mr"><p class="lt lu ms lv b lw lx kq ly lz ma kt mb mt md me mf mu mh mi mj mv ml mm mn mo iz ga" id="1c12"><em class="jg">From CI/CD to CT (Continuous training). CT is a new property, unique to ML systems, that’s concerned with automatically retraining and serving the models</em></p></blockquote><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="572d">I hope you find this article helpful. If you have any questions, feedback or if you want to brainstorm on the content of this article, please drop a comment here or reach out to me on <a class="au nn" href="https://www.linkedin.com/in/oren-razon/?originalSubdomain=il" rel="noopener ugc nofollow" target="_blank">LinkedIn</a></p></div><div class="o dx mw mx ii my" role="separator"><span class="mz fl ci na nb nc"></span><span class="mz fl ci na nb nc"></span><span class="mz fl ci na nb"></span></div><div class="iz ja jb jc jd"><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="ea01">I would like to thank my fellow colleagues <a class="au nn" href="https://medium.com/u/86c5e042163c?source=post_page-----fd90478f97fc--------------------------------" rel="noopener">Pearl Lieberman</a>, <a class="au nn" href="https://medium.com/u/4b1a8c1d089a?source=post_page-----fd90478f97fc--------------------------------" rel="noopener">Or Itzahary</a>, and <a class="au nn" href="https://medium.com/u/4dde5994e6c1?source=post_page-----fd90478f97fc--------------------------------" rel="noopener">Ori Cohen</a> for their insightful comments and ideas</p></div><div class="o dx mw mx ii my" role="separator"><span class="mz fl ci na nb nc"></span><span class="mz fl ci na nb nc"></span><span class="mz fl ci na nb"></span></div><div class="iz ja jb jc jd"><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="a590"><a class="au nn" href="https://www.linkedin.com/in/oren-razon/" rel="noopener ugc nofollow" target="_blank"><em class="ms">Oren Razon</em></a><em class="ms"> is the co-founder and CTO of </em><a class="au nn" href="https://www.superwise.ai/" rel="noopener ugc nofollow" target="_blank"><em class="ms">superwise.ai</em></a><em class="ms"> a company that empowers data science &amp; operational teams with the visibility and control to scale their AI activities using an advanced ML monitoring platform. Oren is an experienced ML practitioner, leading and consulting for large scale ML activities at startups and enterprises in the last 15 years.</em></p><p class="pw-post-body-paragraph lt lu jg lv b lw lx kq ly lz ma kt mb mc md me mf mg mh mi mj mk ml mm mn mo iz ga" id="d281"><em class="ms">I’m always looking for an excuse to read, write, talk, and share ideas on MLOps topics.</em></p></div></div></section></div></div></article>